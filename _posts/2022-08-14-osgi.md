---
title: "osgi"
categories:
  -  Java
tags:
  -  Framework
---


### Goal
* Osgi에 대해서 알아보자
* maven ipojo에 대해서 알아보자

## OSGI

osgi의 개념은 아래의 블로그를 참고하여 알수있다.

[블로그](https://m.blog.naver.com/azure0777/220637857108)

다음은 참고한 개념 내용이다.

OSGI(Open Service Gateway initiative) 의 핵심 개념은 프로그램을 만들 때 하나의 큰 프로그램으로 만들지 않고 여러 가지의 작은 프로그램을 만든 후 이것을 하나로 묶어 내는 것입니다.

이 내용을 보고 아래 블로그에서 영어원문을 참고한다면 더욱 잘 이해할 수있다.

[원문해석](https://tech-monster.tistory.com/45?category=1009685)

블로그 내용을 요약하면 다음과 같다.

여러 프로그램을 묶는과정을 번들링이라고 하고 OSGI framework에서 이 모듈들을 각각 등록시키고 요청에 따라 실행을 시키게 된다.

이러한 번들 관리는 osgi 컨테이너에서 이루어진다고 하며 jvm에서 몇가지 추가적인 기능을 제공하는것과 유사하다고 한다.(아마 class file을 관리하듯 번들을 관리하는것을 말하는거 같다.)

osgi 각 모듈들은 독립적으로 작용되며(즉 서로 있든말든 무관하게 개발 가능) 그리고 서로 상호작용도 가능하다.

각각의 모듈은 OSGI에 등록이 되어야 하고 life cycle(프로그램이 설치, 실행, 중지)이 프로그램과 별개로 일어나기 때문에 모듈을 업데이트 하거나 새로운 모듈을 적용할때 프로그램을 종료하지 않아도 된다.

정리 : osgi는 프로그램들을 번들이라는것으로 모듈화 하여 독립적으로 관리하는것이다. 

## Bundle로 빌드해보기

자 위와 같은 특징이 있다는것을 알았다.

솔직히 이론상으로만 살짝 공부하기만 했고 어떻게 활용이 되는지는 정확히 모른다.

그래서 한번 osgi 의 핵심인 번들로 빌드를 시도해보기로 했다.

이것 또한 자료가 좀 적고 레거시한 부분이 많아서 찾기가 좀 힘들었지만.. 겨우겨우 비슷한 자료와 이용사례를 찾아 활용해 볼 수 있었다.

[로그프레소 코드](https://github.com/logpresso/logpresso-sdk-sentry/blob/master/logpresso-sentry-example/pom.xml)

일단 위에 링크에서 Pom파일의 정보를 어느정도 파악할 수 있었다.

정확하게 이론을 파악한것 보단 설명과 메타데이터 정보를 보며 번들 빌드 작업 관련 내용이라는 것을 알 수 있었다.

이를 통해 나도 일단 비슷하게 폼을 작성해보았다.



```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>javaStudy.maven</groupId>
	<artifactId>maven-study</artifactId>
	<version>0.0.1</version>

	<name>maven-study</name>
	<!-- FIXME change it to the project's website -->
	<url>http://www.example.com</url>
	<packaging>bundle</packaging>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<maven.compiler.source>1.7</maven.compiler.source>
		<maven.compiler.target>1.7</maven.compiler.target>
	</properties>

	<dependencies>
		<dependency>
			<groupId>org.osgi</groupId>
			<artifactId>org.osgi.core</artifactId>
			<version>6.0.0</version>
		</dependency>

		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>4.11</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<version>1.18.24</version>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>org.apache.felix</groupId>
			<artifactId>org.apache.felix.ipojo</artifactId>
			<version>1.12.1</version>
		</dependency>
		<dependency>
			<groupId>org.apache.felix</groupId>
			<artifactId>org.apache.felix.ipojo.annotations</artifactId>
			<version>1.12.1</version>
		</dependency>
	</dependencies>


	<build>

		<plugins>
			<plugin>
				<groupId>org.apache.felix</groupId>
				<artifactId>maven-bundle-plugin</artifactId>
				<extensions>true</extensions>
				<configuration>
					<instructions>
						<Bundle-SymbolicName>${project.groupId}.${project.artifactId}</Bundle-SymbolicName>
						<Bundle-Name>${project.artifactId}</Bundle-Name>
						<Import-Package>*</Import-Package>
					</instructions>

				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.felix</groupId>
				<artifactId>maven-ipojo-plugin</artifactId>
				<version>1.4.0</version>
				<executions>
					<execution>
						<goals>
							<goal>ipojo-bundle</goal>
						</goals>
					</execution>
				</executions>
			</plugin>



			<plugin>
				<artifactId>maven-jar-plugin</artifactId>
				<version>3.0.2</version>
				<configuration>
					<archive>
						<manifest>
							<addClasspath>true</addClasspath>
							<classpathPrefix>libs/</classpathPrefix>
							<mainClass>
								javaStudy.maven.maven_study.App
							</mainClass>
						</manifest>
					</archive>
				</configuration>
			</plugin>


		</plugins>
	</build>
</project>

```

참고로 그전에 내가 [maven](https://superdevsong.github.io/devops/maven/)을 공부할때 작성했던 폼에서 이어서 작성한거라 그전 내용도 남아있다.

packaging을 bundle로 설정하였고 그밖에 플러그인과 나중에 사용할 ipojo를 추가하였다.

기본적으로 packaging은 번들이라는 property가 없다. 그럼에도 가능한 이유는 bundle plugin을 추가하였기 때문이다.

bundle plugin에 대해서 좀 더 알아보고 다음에 더 확실히 정리해보겠다.

일단 이렇게 설정하고 빌드를하면 똑같이 target 파일에 jar파일이 생성된것을 확인할 수 있다.

그러면 번들이나 jar파일이나 차이가 뭘까?

그에 대한 해답은 다음 링크를 참고하기 바란다.

[해답](https://stackoverflow.com/questions/20258698/difference-between-osgi-bundle-and-normal-jar-files-usage)

여기서는 번들 같은 경우 다른번들과 안전하게 공유할 수 있는 메타데이터가 추가되며 그외에는 큰 차이가 없다고 한다.

다음에는 puglin에 대한 정보와 Osgi의 활용 중점으로 더 정리해 보겠다.





### 참고 : 

[bundle-plugin](https://felix.apache.org/documentation/subprojects/apache-felix-maven-bundle-plugin-bnd.html)

[참고 blog](https://m.blog.naver.com/azure0777/220637857108)

